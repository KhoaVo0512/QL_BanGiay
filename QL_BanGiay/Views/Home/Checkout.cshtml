@model QL_BanGiay.Models.CheckOutModel
@{
    ViewData["Title"] = "Checkout";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="~/css/Checkout.css" />
<div id="wrapper">
    <!-- Page -->
    <div class="page-wrapper">
        <main class="page-main">
            <div class="block">
                <div class="container">
                    <ul class="breadcrumbs">
                        <li><a href="index.html">Trang Chu</a></li>
                        <li>/<span>Checkout</span></li>
                    </ul>
                </div>
            </div>
            <div class="block">
                <div class="container">
                    <div class="row">
                        <div class="col-md-5">
                            <h2>CHI TIẾT THANH TOÁN</h2>
                            <form class="white" action="#" id="checkoutForm">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <label>Họ<span class="required">*</span></label>
                                        <input asp-for="Ho" id="Ho" type="text" class="form-control">
                                        <span class="text-danger" asp-validation-for="Ho"></span>
                                    </div>
                                    <div class="col-sm-6">
                                        <label>Tên<span class="required">*</span></label>
                                        <input asp-for="Ten" id="Ten" type="text" class="form-control">
                                        <span class="text-danger" asp-validation-for="Ho"></span>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6">
                                        <label>E-mail<span class="required">*</span></label>
                                        <input asp-for="Email" id="Email" type="text" class="form-control">
                                        <span class="text-danger" asp-validation-for="Email"></span>
                                    </div>
                                    <div class="col-sm-6">
                                        <label>Số điện thoại<span class="required">*</span></label>
                                        <input asp-for="Sdt" id="Sdt" type="text" class="form-control">
                                        <span class="text-danger" asp-validation-for="Sdt"></span>
                                    </div>
                                </div>
                                <label>Địa chỉ</label>
                                <input asp-for="DiaChi" type="text" class="form-control">
                                <span class="text-danger" asp-validation-for="DiaChi"></span>
                                <div class="row">
                                    <div class="form-input col-sm-4">
                                        <label>Tỉnh</label>
                                        <select asp-for="MaTinh" class="form-select" id="Tinh" required>
                                            <option value="" label="----Chọn----"></option>
                                        </select>
                                        <span asp-validation-for="MaTinh" class="text-danger"></span>
                                    </div>
                                    <div class="form-input col-sm-4">
                                        <label>Huyện</label>
                                        <select asp-for="MaHuyen" required class="form-select" id="Huyen">
                                            <option value="">----Chọn----</option>
                                        </select>
                                        <span asp-validation-for="MaHuyen" class="text-danger"></span>
                                    </div>
                                    <div class="form-input col-sm-4">
                                        <label>Xã</label>
                                        <select asp-for="MaXa" class="form-select" id="Xa">
                                            <option value="">----Chọn----</option>
                                        </select>
                                        <span asp-validation-for="MaXa" class="text-danger"></span>
                                    </div>
                                </div>
                            </form>
                            @* <h2>Delivery</h2>
                            <p>Choose delivery option below</p>
                            <form class="white" action="#">
                            <div class="radioset">
                            <label class="radio">
                            <input id="radioDelivery1" type="radio" name="radioDelivery" value="none">
                            <span class="outer"><span class="inner"></span></span><b>Standard Delivery</b> $5.99 / Delivery in 5 to 7 business Days
                            </label>
                            <label class="radio">
                            <input id="radioDelivery2" type="radio" name="radioDelivery" value="none">
                            <span class="outer"><span class="inner"></span></span><b>Express Delivery</b> $19.99 / Delivery in 1 business Days
                            </label>
                            </div>
                            </form>
                            <h2>Payment & Order Review</h2>
                            <form class="white" action="#">
                            <p>Credit Card</p>
                            <p class="payment-link">
                            <a href="#"><img src="images/payment-logo/icon-pay-1.png" alt=""></a>
                            <a href="#"><img src="images/payment-logo/icon-pay-2.png" alt=""></a>
                            <a href="#"><img src="images/payment-logo/icon-pay-3.png" alt=""></a>
                            <a href="#"><img src="images/payment-logo/icon-pay-4.png" alt=""></a>
                            <a href="#"><img src="images/payment-logo/icon-pay-5.png" alt=""></a>
                            </p>
                            <div class="row">
                            <div class="col-sm-6">
                            <label>Credit Card Number<span class="required">*</span></label>
                            <input type="text" class="form-control">
                            </div>
                            <div class="col-xs-6 col-sm-3">
                            <label>Month<span class="required">*</span></label>
                            <div class="select-wrapper">
                            <select class="form-control">
                            <option value="">01</option>
                            </select>
                            </div>
                            </div>
                            <div class="col-xs-6 col-sm-3">
                            <label>Year<span class="required">*</span></label>
                            <div class="select-wrapper">
                            <select class="form-control">
                            <option value="">2017</option>
                            </select>
                            </div>
                            </div>
                            </div>
                            </form>*@
                        </div>
                        <div class="col-md-7">
                            <h2>
                                ĐƠN HÀNG CỦA BẠN
                            </h2>
                            <div class="cart-table cart-table--sm">
                                <div class="table-header">
                                    <div class="photo">
                                        Hình ảnh
                                    </div>
                                    <div class="name">
                                        Tên sản phẩm
                                    </div>
                                    <div class="price">
                                        Giá
                                    </div>
                                    <div class="qty">
                                        Số lượng
                                    </div>
                                    <div class="subtotal">
                                        Tổng cộng
                                    </div>
                                </div>
                            </div>
                            <table class="total-price">
                                <tr>
                                    <td>Tổng thể</td>
                                    <td id="Subtotal"></td>
                                </tr>
                                <tr>
                                    <td>Giảm giá</td>
                                    <td>0 VND</td>
                                </tr>
                                <tr class="total">
                                    <td>Tổng cộng</td>
                                    <td id="GrandTotal"></td>
                                </tr>
                            </table>
                            <div class="clearfix"></div>
                            <h2>Ghi chú đặt hàng</h2>
                            <form class="white" action="#">
                                <label>
                                    Ghi chú về đơn đặt hàng của bạn, ví dụ: ghi chú đặc biệt cho giao hàng
                                </label>
                                <textarea id="Note" class="form-control"></textarea>
                                <div>
                                    <button id="checkoutsubmit" class="btn btn-alt">XÁC NHẬN ĐƠN HÀNG</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <!-- /Page Content -->
    </div>
    <!-- Page Content -->
</div>
@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js" integrity="sha512-rstIgDs0xPgmG6RX1Aba4KV5cWJbAMcvRCVmglpam9SoHZiUCyQVDdH2LPlxoHtrv17XWblE/V/PP+Tr04hbtA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/4.0.0/jquery.validate.unobtrusive.min.js" integrity="sha512-xq+Vm8jC94ynOikewaQXMEkJIOBp7iArs3IhFWSWdRT3Pq8wFz46p+ZDFAR7kHnSFf+zUv52B3prRYnbDRdgog==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        $(document).ready(function () {
            var arrSanPham = storage.getCart();
            var grandTotal = 0;
            var items = new Array();
            if (arrSanPham != null) {
                for (var i = 0; i < arrSanPham.length; i++) {
                    $.get("/home/checkoutdetails?idSanPham=" + arrSanPham[i].id + "&SoLuong=" + arrSanPham[i].count + "&SizeGiay=" + arrSanPham[i].size + "&idSize=" + arrSanPham[i].idsize, function (data) {
                        $(".cart-table").append(data);
                    });
                    items.push({ Id: arrSanPham[i].id, Idsize: arrSanPham[i].idsize, Quantity: arrSanPham[i].count, Total: arrSanPham[i].total })
                    grandTotal += arrSanPham[i].total;
                }
            }
            console.log(grandTotal);
            $.validator.unobtrusive.parse($("#checkoutForm"));
            getTinh();
            $('#Huyen').attr('disabled', true);
            $('#Xa').attr('disabled', true);
            $("#Tinh").change(function () {
                var id = $(this).val();
                $('#Huyen').attr('disabled', false);
                $('#Huyen').empty();
                $('#Huyen').append('<option value="">----Chọn----</option>');
                $('#Xa').attr('disabled', true);
                $('#Xa').empty();
                $('#Xa').append('<option value="">----Chọn----</option>');
                $.ajax({
                    url: '/account/Huyen?id=' + id,
                    success: function (result) {
                        $.each(result, function (i, data) {
                            $('#Huyen').append('<option value=' + data['maHuyen'] + '>' + data['tenHuyen'] + '</option>');
                        });
                    }
                });
            });
            $("#Huyen").change(function () {
                $('#Xa').attr('disabled', false);
                var id = $(this).val();
                $('#Xa').empty();
                $('#Xa').append('<option value="">----Chọn----</option>');
                $.ajax({
                    url: '/account/Xa?id=' + id,
                    success: function (result) {
                        $.each(result, function (i, data) {
                            $('#Xa').append('<option value=' + data['maXa'] + '>' + data['tenXa'] + '</option>');
                        });
                    }
                });
            });
            function getTinh() {
                $.ajax({
                    url: '/account/Tinh',
                    success: function (result) {
                        $.each(result, function (i, data) {
                            $('#Tinh').append('<option value=' + data['maTinh'] + '>' + data['tenTinh'] + '</option>');
                        });
                    }
                });
            }
            var Subtotal = document.getElementById('Subtotal');
            Subtotal.innerHTML = grandTotal.toLocaleString('it-IT', { style: 'currency', currency: 'VND' });
            var GrandTotal = document.getElementById('GrandTotal');
            GrandTotal.innerHTML = grandTotal.toLocaleString('it-IT', { style: 'currency', currency: 'VND' });
        });

        var checkout = document.getElementById('checkoutsubmit');
        checkout.addEventListener('click', function (e) {
            e.preventDefault();
            if ($("#checkoutForm").valid()) {
                var formData = $("#checkoutForm").serialize();
                var note = document.getElementById('Note').value;
                if (note == "")
                    note = 'No';
                $.ajax({
                    url: "/home/checkoutdetails/" + note,
                    type: "POST",
                    data: formData,
                    success: function (response) {
                        alert(response);
                    },
                    error: function (request, status, error) {
                        alert(request.responseText);
                    }
                });
            }
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetJsonData","Home")',
                dataType: "json",
                data: JSON.stringify(items),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    alert(response);
                },
                error: function (request, status, error) {
                    alert(request.responseText);
                }
            });
        });
    </script>
}